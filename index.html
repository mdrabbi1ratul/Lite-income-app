<!DOCTYPE html>  
<html lang="bn">  
<head>  
    <meta charset="UTF-8">  
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">  
    <title>Lite Income - Professional App</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>
    
    <script src='//libtl.com/sdk.js' data-zone='10411839' data-sdk='show_10411839'></script>  

<style>
    :root { --primary-blue: #3498db; --dark-bg: #0a0b10; --card-bg: #161b22; --text-white: #e6edf3; --accent-red: #e74c3c; --success-green: #2ecc71; --warning-yellow: #f1c40f; }
    body { margin:0; font-family: 'Segoe UI', sans-serif; background: var(--dark-bg); color: var(--text-white); padding: 15px; padding-bottom: 100px; user-select: none; }
    
    .streak-container { display: flex; justify-content: center; margin-bottom: -15px; position: relative; z-index: 10; }
    .streak-badge { 
        background: linear-gradient(135deg, #ff9d00, #ff5e00); 
        color: white; 
        padding: 6px 18px; 
        border-radius: 50px; 
        font-weight: 800; 
        font-size: 14px; 
        display: flex; 
        align-items: center; 
        gap: 8px; 
        box-shadow: 0 4px 15px rgba(255, 94, 0, 0.4); 
        border: 2px solid rgba(255,255,255,0.2);
        animation: pulse-glow 2s infinite;
    }
    @keyframes pulse-glow {
        0% { transform: scale(1); box-shadow: 0 4px 15px rgba(255, 94, 0, 0.4); }
        50% { transform: scale(1.05); box-shadow: 0 4px 25px rgba(255, 94, 0, 0.6); }
        100% { transform: scale(1); box-shadow: 0 4px 15px rgba(255, 94, 0, 0.4); }
    }
    .streak-text { letter-spacing: 0.5px; text-shadow: 1px 1px 2px rgba(0,0,0,0.3); }

    #captchaCode { font-size: 32px; letter-spacing: 10px; font-weight: bold; color: #fff; background: #1c2128; padding: 15px; border-radius: 8px; border: 1px dashed var(--primary-blue); user-select: none; margin: 15px 0; text-align: center; }
    #captchaInput { text-align: center; font-size: 18px; text-transform: uppercase; letter-spacing: 5px; border: 2px solid #30363d; }
    #captchaTimer { color: var(--warning-yellow); font-weight: bold; font-size: 18px; margin: 10px 0; display: none; }

    .ref-box { background: #0d1117; padding: 12px; border-radius: 8px; border: 1px solid #30363d; font-size: 11px; color: #8b949e; margin: 15px 0; word-break: break-all; white-space: normal; line-height: 1.4; }
    .nav-bar { position: fixed; bottom: 15px; left: 10px; right: 10px; background: rgba(22, 27, 34, 0.95); display: flex; justify-content: space-around; padding: 12px 5px; border-radius: 25px; border: 1px solid rgba(52, 152, 219, 0.3); box-shadow: 0 8px 32px rgba(0,0,0,0.5); z-index: 1000; backdrop-filter: blur(10px); }
    .nav-item { color: #8b949e; font-size: 11px; text-align: center; cursor: pointer; flex: 1; transition: all 0.3s ease; font-weight: 500; }
    .nav-item span { font-size: 20px; display: block; margin-bottom: 2px; transition: 0.3s; }
    .nav-item.active { color: #fff; transform: translateY(-8px); }
    .nav-item.active span { transform: scale(1.3); text-shadow: 0 0 15px var(--primary-blue); }

    .rank-card { background: linear-gradient(135deg, #161b22, #0d1117); border: 1px solid #30363d; border-radius: 12px; padding: 15px; margin-bottom: 10px; display: flex; align-items: center; justify-content: space-between; }
    .rank-number { width: 30px; height: 30px; border-radius: 50%; background: var(--primary-blue); display: flex; align-items: center; justify-content: center; font-weight: bold; color: white; margin-right: 15px; }
    .rank-1 { border: 1.5px solid var(--warning-yellow); }
    .rank-1 .rank-number { background: var(--warning-yellow); color: #000; }

    .menu-item { background: #0d1117; border: 1px solid #30363d; border-radius: 10px; padding: 12px; margin-bottom: 10px; display: flex; align-items: center; justify-content: space-between; cursor: pointer; transition: 0.3s; }
    .menu-item:active { background: #1c2128; }

    #auth-page { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: var(--dark-bg); z-index: 5000; display: flex; flex-direction: column; justify-content: center; align-items: center; padding: 20px; box-sizing: border-box; }
    #ban-page, #vpn-page { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #000; z-index: 9999; display: none; flex-direction: column; justify-content: center; align-items: center; text-align: center; padding: 20px; color: white; }
    .pass-container { position: relative; width: 100%; }
    .toggle-pass { position: absolute; right: 10px; top: 50%; transform: translateY(-50%); cursor: pointer; color: var(--primary-blue); font-size: 12px; font-weight: bold; }
    .page { display: none; animation: fadeIn 0.3s ease; }
    .active-page { display: block; }
    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    .card { background: var(--card-bg); border: 1px solid var(--primary-blue); border-radius: 15px; padding: 20px; text-align: center; margin-bottom: 15px; position: relative; }
    .main-bal { font-size: 42px; font-weight: bold; color: var(--primary-blue); margin: 10px 0; }
    .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
    .grid-item { background: #0d1117; border: 2px solid #30363d; border-radius: 12px; padding: 15px; text-align: center; }
    .grid-item span { font-size: 14px; color: var(--primary-blue); font-weight: bold; }
    .grid-item p { margin: 8px 0 0; font-size: 20px; font-weight: bold; color: #fff; }
    .btn { background: var(--primary-blue); color: #fff; border: none; padding: 15px; border-radius: 10px; width: 100%; font-size: 16px; font-weight: bold; cursor: pointer; margin-top: 10px; transition: 0.2s; }
    .btn:disabled { background: #1e293b !important; cursor: not-allowed; opacity: 0.7; border: 1px solid #334155; }
    .btn-bonus { background: var(--success-green); }
    input, select { width: 100%; padding: 12px; margin: 10px 0; background: #0d1117; border: 1px solid #30363d; color: white; border-radius: 8px; box-sizing: border-box; }
    .hist-item { background: #0d1117; padding: 12px; border-radius: 10px; margin-bottom: 8px; border-left: 4px solid var(--primary-blue); display: flex; justify-content: space-between; align-items: center; }
    .timer-display { font-family: 'Courier New', monospace; font-size: 28px; font-weight: bold; color: var(--success-green); text-shadow: 0 0 10px rgba(46, 204, 113, 0.3); }
    .notice-box { background: rgba(241, 196, 15, 0.1); border: 1px solid var(--warning-yellow); color: var(--warning-yellow); padding: 15px; border-radius: 10px; margin-bottom: 15px; text-align: left; font-size: 14px; }

    .ref-item-card { background: #0d1117; border: 1px solid #30363d; border-radius: 10px; padding: 12px; margin-bottom: 10px; display: flex; justify-content: space-between; align-items: center; }
    .status-pending { color: var(--warning-yellow); font-size: 12px; font-weight: bold; }
    .status-claim { background: var(--success-green); color: white; padding: 5px 10px; border-radius: 5px; font-size: 11px; cursor: pointer; font-weight: bold; border: none; }
    .status-done { color: #8b949e; font-size: 12px; }
    
    .pending-badge { 
        background: var(--success-green); 
        color: white; 
        padding: 4px 12px; 
        border-radius: 20px; 
        font-size: 14px; 
        margin-left: 10px; 
        font-weight: 900;
        box-shadow: 0 2px 10px rgba(46, 204, 113, 0.3);
        border: 1px solid rgba(255,255,255,0.2);
    }
</style>
</head>  
<body>  
    <div id="ban-page">
        <h1 style="color:var(--accent-red); font-size: 40px;">üö´ BANNED</h1>
        <p style="margin: 20px 0;">‡¶Ö‡¶§‡¶ø‡¶∞‡¶ø‡¶ï‡ßç‡¶§ ‡¶á‡¶®‡¶≠‡ßç‡¶Ø‡¶æ‡¶≤‡¶ø‡¶° ‡¶ï‡ßç‡¶≤‡¶ø‡¶ï‡ßá‡¶∞ ‡¶ï‡¶æ‡¶∞‡¶£‡ßá ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü‡¶ü‡¶ø ‡¶¨‡ßç‡¶Ø‡¶æ‡¶® ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá‡•§</p>
        <button class="btn" onclick="window.open('https://t.me/lite_income')">Contact Admin</button>
    </div>

    <div id="vpn-page">
        <h1 style="color:var(--warning-yellow); font-size: 40px;">‚ö†Ô∏è VPN DETECTED</h1>
        <p style="margin: 20px 0;">‡¶®‡¶ø‡¶∞‡¶æ‡¶™‡¶§‡ßç‡¶§‡¶æ‡¶∞ ‡¶ñ‡¶æ‡¶§‡¶ø‡¶∞‡ßá ‡¶≠‡¶ø‡¶™‡¶ø‡¶è‡¶® ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßá ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶™ ‡¶ö‡¶æ‡¶≤‡¶æ‡¶®‡ßã ‡¶®‡¶ø‡¶∑‡ßá‡¶ß‡•§ ‡¶¶‡ßü‡¶æ ‡¶ï‡¶∞‡ßá ‡¶≠‡¶ø‡¶™‡¶ø‡¶è‡¶® ‡¶¨‡¶®‡ßç‡¶ß ‡¶ï‡¶∞‡ßá ‡¶™‡ßÅ‡¶®‡¶∞‡¶æ‡ßü ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶™ ‡¶ì‡¶™‡ßá‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®‡•§</p>
        <button class="btn" onclick="location.reload()">Retry Now</button>
    </div>

    <div id="auth-page">  
        <div class="card" style="width: 100%; max-width: 400px;">  
            <h2 id="auth-title" style="color: var(--primary-blue);">Login</h2>  
            <input type="email" id="auth-email" placeholder="‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶á‡¶Æ‡ßá‡¶á‡¶≤">  
            <div class="pass-container">  
                <input type="password" id="auth-pass" placeholder="‡¶™‡¶æ‡¶∏‡¶ì‡ßü‡¶æ‡¶∞‡ßç‡¶°">  
                <span class="toggle-pass" onclick="togglePassword()">SHOW</span>  
            </div>  
            <button class="btn" id="auth-btn" onclick="handleAuth()">Login Now</button>  
            <p id="auth-toggle-text" style="font-size: 14px; margin-top: 15px;">Account ‡¶®‡ßá‡¶á? <span style="color: var(--primary-blue); cursor: pointer;" onclick="toggleAuth()">Sign Up ‡¶ï‡¶∞‡ßÅ‡¶®</span></p>  
        </div>  
    </div>  

    <div id="main-content" style="display: none;">  
        <div id="home" class="page active-page">  
            <div id="notice-container" class="notice-box">Loading notice...</div>
            
            <div class="streak-container">
                <div class="streak-badge">
                    <span>üî•</span>
                    <span class="streak-text"><span id="hStreak">0</span> ‡¶¶‡¶ø‡¶®‡ßá‡¶∞ ‡¶∏‡ßç‡¶ü‡ßç‡¶∞‡¶ø‡¶ï</span>
                </div>
            </div>

            <div class="card" style="padding-top: 30px;">
                <h4 id="uName">‡¶∏‡ßç‡¶¨‡¶æ‡¶ó‡¶§‡¶Æ!</h4>  
                <div class="main-bal" id="hBal">$0.000</div>  
                <p id="hInvalidUI" style="color:var(--accent-red); font-size:16px; font-weight:bold; margin:0;">Invalid Click: 0 / 5</p>
            </div>  

            <div class="grid">  
                <div class="grid-item"><span>‡¶ü‡ßÅ‡¶°‡ßá ‡¶ü‡¶æ‡¶∏‡ßç‡¶ï</span><p id="hTaskAvail">0</p></div>  
                <div class="grid-item"><span>‡¶∏‡¶´‡¶≤ ‡¶∞‡ßá‡¶´‡¶æ‡¶∞</span><p id="hRefCount">0</p></div>  
                <div class="grid-item" style="grid-column: span 2;"><span>‡¶ü‡ßã‡¶ü‡¶æ‡¶≤ ‡¶è‡¶° ‡¶≠‡¶≠‡¶ø‡¶â</span><p id="hCompleteAds">0 / 0</p></div>  
            </div>  
            <h3 style="margin-top:20px; text-align:left; border-left:3px solid var(--success-green); padding-left:10px;">‡¶°‡ßá‡¶á‡¶≤‡¶ø ‡¶è‡¶ï‡ßç‡¶ü‡¶ø‡¶≠‡¶ø‡¶ü‡¶ø</h3>
            <div id="dailyActivityList" class="hist-list"></div>
        </div>  

        <div id="rank" class="page">
            <h3 style="text-align: center; color: var(--primary-blue);">üèÜ Top 10 Earners</h3>
            <div id="leaderboardList"><p style="text-align:center;">‡¶≤‡¶ø‡¶°‡¶æ‡¶∞‡¶¨‡ßã‡¶∞‡ßç‡¶° ‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...</p></div>
        </div>

        <div id="task" class="page">  
            <div class="card">‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏: <b id="tBal" style="color:var(--primary-blue)">$0.000</b></div>  
            <div class="card" style="background:#0d1117">
                <div style="font-size:12px; color:gray; margin-bottom:5px">NEXT TASK IN</div>
                <div class="timer-display" id="main-timer">00:00:00</div>
            </div>
            <button id="dailyBtn" class="btn btn-bonus" onclick="claimDailyBonus()">Daily Bonus</button>  
            
            <button id="openCaptchaBtn" class="btn" style="background: linear-gradient(to right, #3498db, #2980b9); color: #fff; margin-top:15px;" onclick="openCaptcha()">ü§ñ Play Captcha Entry</button>

            <div id="captchaPanel" class="card" style="display:none; margin-top:15px; background: #0d1117; border: 2px solid var(--primary-blue);">
                <span style="font-weight: bold; color: var(--primary-blue);">ü§ñ Verify Captcha</span>
                <div id="captchaCode">GENERATING...</div>
                <div id="captchaTimer">Next in: 00s</div>
                <input type="text" id="captchaInput" placeholder="‡¶ü‡¶æ‡¶á‡¶™ ‡¶ï‡¶∞‡ßÅ‡¶®">
                <p id="sLimit" style="font-size: 13px; color: var(--text-white);">Tasks: 0 / 0</p>
                <button id="captchaBtn" class="btn" onclick="verifyCaptcha()">SUBMIT CAPTCHA</button>
                <button class="btn" style="background:transparent; border:1px solid gray; font-size:12px;" onclick="document.getElementById('captchaPanel').style.display='none'; document.getElementById('openCaptchaBtn').style.display='block'">Close</button>
            </div>

            <div class="card" style="margin-top:15px; border-style:dashed;">  
                <button id="adBtn" class="btn" onclick="playAd()">Watch Ad</button>  
                <p id="tLimit" style="margin-top:10px;">Ads: 0 / 0</p>
            </div>  
        </div>  

        <div id="withdraw" class="page">  
            <div class="card">  
                <span>‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏: <b id="wBal" style="color:var(--primary-blue)">$0.000</b></span><br>
                <small id="minWithdrawText" style="color: var(--warning-yellow); display: block; margin-top: 5px;">‡¶Æ‡¶ø‡¶®‡¶ø‡¶Æ‡¶æ‡¶Æ ‡¶â‡¶á‡¶•‡¶°‡ßç‡¶∞: $0.00</small>
                <small id="minReferText" style="color: var(--primary-blue); display: block; margin-top: 2px;">‡¶™‡ßç‡¶∞‡ßü‡ßã‡¶ú‡¶®‡ßÄ‡ßü ‡¶∞‡ßá‡¶´‡¶æ‡¶∞: ‡ß¶</small>
                
                <select id="wMethod"><option>bKash</option><option>Nagad</option><option>Recharge</option></select>  
                <input id="wNumber" placeholder="‡¶®‡¶Æ‡ßç‡¶¨‡¶∞">  
                <input id="wAmount" type="number" placeholder="‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£ ($)">  
                <button class="btn" onclick="requestWithdraw()">Request Withdraw</button>  
            </div>
            <h3 style="padding-left:10px; border-left:3px solid var(--primary-blue);">‡¶≤‡ßá‡¶®‡¶¶‡ßá‡¶® ‡¶π‡¶ø‡¶∏‡ßç‡¶ü‡ßç‡¶∞‡¶ø</h3>
            <div class="hist-list" id="withdrawHistoryList"></div>
        </div>  

        <div id="profile" class="page">  
            <div class="card">  
                <h3 style="color:var(--primary-blue); margin-bottom:5px;">‡¶™‡ßç‡¶∞‡ßã‡¶´‡¶æ‡¶á‡¶≤</h3>  
                <p id="pEmail" style="color:gray; font-size: 14px; margin-bottom:15px;"></p>  
                <div class="ref-box" id="refLinkText" style="font-size:13px; font-weight:bold; color:var(--primary-blue);">‡¶≤‡¶ø‡¶ô‡ßç‡¶ï ‡¶§‡ßà‡¶∞‡¶ø ‡¶π‡¶ö‡ßç‡¶õ‡ßá...</div>  
                
                <div style="display: flex; gap: 10px;">
                    <button class="btn" onclick="copyRef()" style="padding:10px; font-size:12px; flex: 1;">Copy Link</button> 
                    <button class="btn" onclick="shareOnTelegram()" style="padding:10px; font-size:12px; flex: 1; background: #229ED9;">Share Telegram</button> 
                </div>
            </div>
            <div class="menu-item" onclick="showPage('refer_claim', this)">
                <span>üë• ‡¶∞‡ßá‡¶´‡¶æ‡¶∞‡ßá‡¶≤ ‡¶¨‡ßã‡¶®‡¶æ‡¶∏ ‡¶ï‡ßç‡¶≤‡ßá‡¶á‡¶Æ <span id="pendingRefBadge" class="pending-badge">0</span></span>
                <span>‚ûî</span>
            </div>
            <div class="menu-item" onclick="window.open('https://t.me/lite_income_app')">
                <span>üéß ‡¶∏‡¶æ‡¶™‡ßã‡¶∞‡ßç‡¶ü ‡¶ö‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶≤ (Telegram)</span>
                <span>‚ûî</span>
            </div>
            <div class="menu-item" onclick="window.open('https://t.me/lite_income')">
                <span>üí¨ ‡¶ï‡¶®‡ßç‡¶ü‡¶æ‡¶ï‡ßç‡¶ü ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶®</span>
                <span>‚ûî</span>
            </div>
            <button class="btn" style="background:var(--accent-red); margin-top:20px;" onclick="logout()">Logout</button>  
        </div>

        <div id="refer_claim" class="page">
            <button onclick="showPage('profile', this)" style="background:none; border:none; color:var(--primary-blue); cursor:pointer; margin-bottom:15px;">‚¨Ö Back to Profile</button>
            <div class="card">
                <h3>Referral Activities</h3>
                <p style="font-size: 12px; color: gray; margin-bottom: 15px;">‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶® ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶™‡ßç‡¶∞‡ßÅ‡¶≠ ‡¶ï‡¶∞‡¶≤‡ßá 'Claim' ‡¶¨‡¶æ‡¶ü‡¶® ‡¶Ü‡¶∏‡¶¨‡ßá‡•§</p>
                <div id="referListContainer">
                    <p style="text-align:center; color:gray;">‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...</p>
                </div>
            </div>
        </div>
    </div>

    <div class="nav-bar">  
        <div class="nav-item active" onclick="showPage('home', this)"><span>üè†</span>Home</div>  
        <div class="nav-item" onclick="showPage('rank', this)"><span>üèÜ</span>Rank</div> 
        <div class="nav-item" onclick="showPage('task', this)"><span>üéØ</span>Task</div>  
        <div class="nav-item" onclick="showPage('withdraw', this)"><span>üí∞</span>Withdraw</div>  
        <div class="nav-item" onclick="showPage('profile', this)"><span>üë§</span>Profile</div>  
    </div>  

<script>
    const tg = window.Telegram.WebApp;
    tg.expand();

    const firebaseConfig = {
        apiKey: "AIzaSyD_umGq2C78hRinwHGl9SNVFuZzb12iooc",
        databaseURL: "https://lite-income-f6287-default-rtdb.firebaseio.com/",
        projectId: "lite-income-f6287",
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    let appConfig = { adLimit: 15, cooldownMins: 720, referReward: 0.10, dailyBonus: 0.05, notice: "‡¶Ö‡ßç‡¶Ø‡¶æ‡¶™‡ßá ‡¶∏‡ßç‡¶¨‡¶æ‡¶ó‡¶§‡¶Æ!", minWithdraw: 1.00, minReferLimit: 0, adReward: 0.005, spinLimit: 10, spinReward: 0.003, spinCooldownSec: 60 };
    let userData = { uid: "", balance: 0.00, ads: 0, spins: 0, lastSpinTime: 0, lastAdTime: 0, taskLockTime: 0, lastDaily: 0, history: [], dailyActivity: {}, referCount: 0, email: "", password: "", status: "Active", invalidClicks: 0, streak: 0, lastActive: 0 };

    // ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶ï‡¶∞‡¶æ ‡¶∞‡ßá‡¶´‡¶æ‡¶∞‡ßá‡¶≤ ‡¶Ü‡¶á‡¶°‡¶ø ‡¶°‡¶ø‡¶ü‡ßá‡¶ï‡ßç‡¶ü‡¶∞
    function getReferrerId() {
        const urlParams = new URLSearchParams(window.location.search);
        let startParam = urlParams.get('tgWebAppStartParam') || urlParams.get('start');
        
        // ‡¶ü‡ßá‡¶≤‡¶ø‡¶ó‡ßç‡¶∞‡¶æ‡¶Æ ‡¶Ö‡¶¨‡¶ú‡ßá‡¶ï‡ßç‡¶ü ‡¶•‡ßá‡¶ï‡ßá ‡¶∏‡¶∞‡¶æ‡¶∏‡¶∞‡¶ø ‡¶ü‡ßç‡¶∞‡¶æ‡¶á
        if (!startParam && tg.initDataUnsafe && tg.initDataUnsafe.start_param) {
            startParam = tg.initDataUnsafe.start_param;
        }
        return startParam;
    }

    async function detectVPN() {
        try {
            const userTimezone = Intl.DateTimeFormat().resolvedOptions().timeZone;
            if (userTimezone !== "Asia/Dhaka") return true;
            return false;
        } catch (error) { return false; }
    }

    async function initApp() {
        const isVPN = await detectVPN();
        if (isVPN) {
            document.getElementById('vpn-page').style.display = 'flex';
            document.getElementById('auth-page').style.display = 'none';
            document.getElementById('main-content').style.display = 'none';
            return;
        }
        const savedUid = localStorage.getItem('lite_user_id');
        if(savedUid) {
            db.ref('users/' + savedUid).once('value', snap => { 
                if(snap.exists()) { userData = snap.val(); loginSuccess(); } 
            });
        }
    }
    initApp();

    db.ref('app_config').on('value', snap => {
        if(snap.exists()) {
            appConfig = {...appConfig, ...snap.val()};
            document.getElementById('notice-container').innerText = appConfig.notice || "‡¶ï‡ßã‡¶®‡ßã ‡¶®‡ßã‡¶ü‡¶ø‡¶∂ ‡¶®‡ßá‡¶á‡•§";
            document.getElementById('minWithdrawText').innerText = "‡¶Æ‡¶ø‡¶®‡¶ø‡¶Æ‡¶æ‡¶Æ ‡¶â‡¶á‡¶•‡¶°‡ßç‡¶∞: $" + (parseFloat(appConfig.minWithdraw) || 1.00).toFixed(2);
            document.getElementById('minReferText').innerText = "‡¶™‡ßç‡¶∞‡ßü‡ßã‡¶ú‡¶®‡ßÄ‡ßü ‡¶∞‡ßá‡¶´‡¶æ‡¶∞: " + (parseInt(appConfig.minReferLimit) || 0) + " ‡¶ü‡¶ø";
            updateUI();
        }
    });

    function handleAuth() {
        const email = document.getElementById('auth-email').value.trim(), 
              pass = document.getElementById('auth-pass').value.trim(), 
              mode = document.getElementById('auth-title').innerText;
              
        if (!email || !pass) return alert("‡¶∏‡¶¨ ‡¶™‡ßÇ‡¶∞‡¶£ ‡¶ï‡¶∞‡ßÅ‡¶®!");
        const uid = btoa(email).replace(/[^a-zA-Z0-9]/g, "").substring(0, 15);
        
        if (mode === "Sign Up") {
            db.ref('users/' + uid).once('value', snap => {
                if (snap.exists()) alert("‡¶è‡¶á ‡¶á‡¶Æ‡ßá‡¶á‡¶≤ ‡¶¶‡¶ø‡ßü‡ßá ‡¶Ö‡¶≤‡¶∞‡ßá‡¶°‡¶ø ‡¶è‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü ‡¶ñ‡ßã‡¶≤‡¶æ ‡¶Ü‡¶õ‡ßá!");
                else {
                    const newUserData = {
                        uid: uid, email: email, password: pass, balance: 0.00,
                        ads: 0, spins: 0, referCount: 0, status: "Active",
                        invalidClicks: 0, streak: 1, lastActive: Date.now(), lastDaily: 0
                    };

                    db.ref('users/' + uid).set(newUserData).then(() => {
                        // ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶ï‡¶∞‡¶æ ‡¶∞‡ßá‡¶´‡¶æ‡¶∞‡ßá‡¶≤ ‡¶≤‡¶ú‡¶ø‡¶ï
                        const refBy = getReferrerId();

                        if(refBy && refBy !== uid && refBy.length > 5) {
                            db.ref('refer_pending').push({
                                referrerUid: refBy,
                                referredEmail: email,
                                status: "Pending",
                                date: new Date().toLocaleDateString()
                            }).then(() => {
                                console.log("Referral recorded successfully");
                            }).catch(err => console.error("Referral failed", err));
                        }
                        alert("‡¶∞‡ßá‡¶ú‡¶ø‡¶∏‡ßç‡¶ü‡ßç‡¶∞‡ßá‡¶∂‡¶® ‡¶∏‡¶´‡¶≤ ‡¶π‡ßü‡ßá‡¶õ‡ßá! ‡¶è‡¶ñ‡¶® ‡¶≤‡¶ó‡¶á‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®‡•§"); 
                        toggleAuth();
                    });
                }
            });
        } else {
            db.ref('users/' + uid).once('value', snap => {
                if (snap.exists() && snap.val().password === pass) {
                    userData = snap.val(); 
                    localStorage.setItem('lite_user_id', uid); 
                    loginSuccess();
                } else alert("‡¶≠‡ßÅ‡¶≤ ‡¶á‡¶Æ‡ßá‡¶á‡¶≤ ‡¶¨‡¶æ ‡¶™‡¶æ‡¶∏‡¶ì‡ßü‡¶æ‡¶∞‡ßç‡¶°!");
            });
        }
    }

    function loginSuccess() {
        document.getElementById('auth-page').style.display = 'none';
        db.ref('users/' + userData.uid).on('value', snap => { 
            if(snap.exists()) { 
                userData = snap.val(); 
                if(userData.status === "Banned") {
                    document.getElementById('main-content').style.display = 'none';
                    document.getElementById('ban-page').style.display = 'flex';
                } else {
                    document.getElementById('main-content').style.display = 'block';
                    updateUI(); 
                }
            } 
        });
        checkStreak();
        fetchWithdrawHistory();
        fetchLeaderboard();
        listenPendingCount();
    }

    function listenPendingCount() {
        db.ref('refer_pending').orderByChild('referrerUid').equalTo(userData.uid).on('value', snap => {
            let count = 0;
            if (snap.exists()) {
                snap.forEach(child => {
                    const data = child.val();
                    if (data.status === "Pending" || data.status === "Approved") count++;
                });
            }
            document.getElementById('pendingRefBadge').innerText = count;
        });
    }

    function checkStreak() {
        const now = new Date();
        const lastActive = new Date(userData.lastActive || 0);
        const diffInDays = Math.floor((now.getTime() - lastActive.getTime()) / (1000 * 3600 * 24));
        if (diffInDays === 1) {
            db.ref('users/' + userData.uid).update({ streak: (userData.streak || 0) + 1, lastActive: Date.now() });
        } else if (diffInDays > 1) {
            db.ref('users/' + userData.uid).update({ streak: 1, lastActive: Date.now() });
        } else if (!userData.lastActive) {
            db.ref('users/' + userData.uid).update({ streak: 1, lastActive: Date.now() });
        }
    }

    function updateUI() {
        if(!userData.uid) return;
        const bal = (parseFloat(userData.balance) || 0).toFixed(3);
        document.getElementById('hBal').innerText = "$" + bal;
        document.getElementById('tBal').innerText = "$" + bal;
        document.getElementById('wBal').innerText = "$" + bal;
        document.getElementById('pEmail').innerText = userData.email;
        document.getElementById('hStreak').innerText = userData.streak || 0;
        document.getElementById('hRefCount').innerText = userData.referCount || 0;
        document.getElementById('hInvalidUI').innerText = "Invalid Click: " + (userData.invalidClicks || 0) + " / 5";
        
        const totalAdLimit = parseInt(appConfig.adLimit) || 15;
        const totalSpinLimit = parseInt(appConfig.spinLimit) || 10;
        const doneAds = parseInt(userData.ads) || 0;
        const doneSpins = parseInt(userData.spins) || 0;
        const remainingTasks = (totalAdLimit + totalSpinLimit) - (doneAds + doneSpins);
        
        document.getElementById('hTaskAvail').innerText = remainingTasks > 0 ? remainingTasks : 0;
        document.getElementById('hCompleteAds').innerText = doneAds + " / " + totalAdLimit;
        document.getElementById('tLimit').innerText = "Ads: " + doneAds + " / " + totalAdLimit;
        document.getElementById('sLimit').innerText = "Tasks: " + doneSpins + " / " + totalSpinLimit;
        document.getElementById('refLinkText').innerText = "Refer ID: " + userData.uid;
        
        const dBtn = document.getElementById('dailyBtn');
        if (new Date().toDateString() === new Date(userData.lastDaily || 0).toDateString()) {
            dBtn.disabled = true; dBtn.innerText = "Claimed";
        } else {
            dBtn.disabled = false; dBtn.innerText = "Daily Bonus";
        }
        checkCooldowns();
        renderDailyActivity();
        handleCaptchaCooldownUI();
    }

    function fetchReferralList() {
        const container = document.getElementById('referListContainer');
        db.ref('refer_pending').orderByChild('referrerUid').equalTo(userData.uid).on('value', snap => {
            let html = "";
            if (!snap.exists()) {
                container.innerHTML = "<p style='text-align:center; color:gray;'>‡¶ï‡ßã‡¶®‡ßã ‡¶∞‡ßá‡¶´‡¶æ‡¶∞‡ßá‡¶≤ ‡¶™‡¶æ‡¶ì‡ßü‡¶æ ‡¶Ø‡¶æ‡ßü‡¶®‡¶ø</p>";
                return;
            }
            snap.forEach(child => {
                const data = child.val();
                const key = child.key;
                let statusUI = "";
                if (data.status === "Pending") statusUI = `<span class="status-pending">Wait for Admin</span>`;
                else if (data.status === "Approved") statusUI = `<button class="status-claim" onclick="processClaim('${key}')">Claim Now</button>`;
                else statusUI = `<span class="status-done">Claimed ‚úÖ</span>`;

                html += `<div class="ref-item-card">
                            <div style="text-align:left;">
                                <b style="font-size:13px;">${data.referredEmail.split('@')[0]}</b><br>
                                <small style="color:gray;">${data.date || ''}</small>
                            </div>
                            <div>${statusUI}</div>
                         </div>`;
            });
            container.innerHTML = html;
        });
    }

    function processClaim(key) {
        const reward = parseFloat(appConfig.referReward) || 0.10;
        db.ref('users/' + userData.uid).transaction((current) => {
            if (current) {
                current.balance = (parseFloat(current.balance) || 0) + reward;
                current.referCount = (parseInt(current.referCount) || 0) + 1;
            }
            return current;
        }).then(() => {
            db.ref('refer_pending/' + key).update({ status: "Claimed" });
            alert("Congrats! Received $" + reward);
        });
    }

    let currentCaptcha = "";
    let captchaInterval;
    function openCaptcha() {
        document.getElementById('captchaPanel').style.display = 'block';
        document.getElementById('openCaptchaBtn').style.display = 'none';
        generateNewCaptcha();
    }
    function generateNewCaptcha() {
        const chars = "0123456789ABCDEFGHJKLMNPQRSTUVWXYZ";
        let result = "";
        for (let i = 0; i < 6; i++) { result += chars.charAt(Math.floor(Math.random() * chars.length)); }
        currentCaptcha = result;
        document.getElementById('captchaCode').innerText = result;
        document.getElementById('captchaInput').value = "";
    }
    function handleCaptchaCooldownUI() {
        const timerText = document.getElementById('captchaTimer'), captchaBtn = document.getElementById('captchaBtn');
        const cooldown = (parseInt(appConfig.spinCooldownSec) || 60) * 1000;
        const diff = (userData.lastSpinTime || 0) + cooldown - Date.now();
        if (diff > 0) {
            captchaBtn.disabled = true; timerText.style.display = "block";
            if (captchaInterval) clearInterval(captchaInterval);
            captchaInterval = setInterval(() => {
                const remaining = Math.ceil(((userData.lastSpinTime || 0) + cooldown - Date.now()) / 1000);
                if (remaining <= 0) { clearInterval(captchaInterval); timerText.style.display = "none"; if(captchaBtn) captchaBtn.disabled = false; generateNewCaptcha(); }
                else { timerText.innerText = `Next in: ${remaining}s`; }
            }, 1000);
        } else { if(captchaBtn) captchaBtn.disabled = false; if(timerText) timerText.style.display = "none"; }
    }
    function verifyCaptcha() {
        const userInput = document.getElementById('captchaInput').value.trim().toUpperCase();
        if (userData.spins >= (parseInt(appConfig.spinLimit) || 10)) return alert("‡¶≤‡¶ø‡¶Æ‡¶ø‡¶ü ‡¶∂‡ßá‡¶∑!");
        if (userInput !== currentCaptcha) { alert("‡¶≠‡ßÅ‡¶≤ ‡¶ï‡ßç‡¶Ø‡¶æ‡¶™‡¶ö‡¶æ!"); generateNewCaptcha(); return; }
        const btn = document.getElementById('captchaBtn');
        btn.disabled = true;
        if (typeof show_10411839 === 'function') {
            show_10411839().then(() => { processCaptchaReward(); }).catch(() => { alert("‡¶è‡¶° ‡¶≤‡ßã‡¶° ‡¶π‡ßü‡¶®‡¶ø"); btn.disabled = false; });
        } else { processCaptchaReward(); }
    }
    function processCaptchaReward() {
        const today = new Date().toDateString();
        let activity = userData.dailyActivity || {};
        if(!activity[today]) activity[today] = { ads: 0, income: 0, bonus: 0 };
        let reward = parseFloat(appConfig.spinReward) || 0.003;
        activity[today].income = (parseFloat(activity[today].income) || 0) + reward;
        db.ref('users/' + userData.uid).update({ 
            balance: (parseFloat(userData.balance) + reward), 
            spins: (parseInt(userData.spins) || 0) + 1, 
            lastSpinTime: Date.now(), 
            dailyActivity: activity, 
            lastActive: Date.now() 
        });
    }

    function playAd() { 
        if (userData.ads >= appConfig.adLimit) return alert("Limit Over!"); 
        if (typeof show_10411839 === 'function') { 
            const btn = document.getElementById('adBtn'); btn.disabled = true;
            show_10411839().then(() => { 
                const today = new Date().toDateString(); 
                let activity = userData.dailyActivity || {}; 
                if(!activity[today]) activity[today] = { ads: 0, income: 0, bonus: 0 }; 
                let adRew = parseFloat(appConfig.adReward) || 0.005; 
                activity[today].ads = (parseInt(activity[today].ads) || 0) + 1;
                activity[today].income = (parseFloat(activity[today].income) || 0) + adRew;
                let updates = { balance: (parseFloat(userData.balance) + adRew), ads: (parseInt(userData.ads) + 1), lastAdTime: Date.now(), dailyActivity: activity, lastActive: Date.now() }; 
                if (updates.ads >= appConfig.adLimit) updates.taskLockTime = Date.now() + (appConfig.cooldownMins * 60000); 
                db.ref('users/' + userData.uid).update(updates);
            }).catch(() => { btn.disabled = false; }); 
        } 
    }

    function requestWithdraw() { 
        const amt = parseFloat(document.getElementById('wAmount').value), method = document.getElementById('wMethod').value, num = document.getElementById('wNumber').value; 
        const minLimit = parseFloat(appConfig.minWithdraw) || 1.00; 
        const minRef = parseInt(appConfig.minReferLimit) || 0;
        const userRef = parseInt(userData.referCount) || 0;

        if(!num || isNaN(amt)) return alert("‡¶∏‡¶¨ ‡¶™‡ßÇ‡¶∞‡¶£ ‡¶ï‡¶∞‡ßÅ‡¶®!"); 
        if(userRef < minRef) return alert("‡¶ï‡¶Æ‡¶™‡¶ï‡ßç‡¶∑‡ßá " + minRef + " ‡¶ü‡¶ø ‡¶∞‡ßá‡¶´‡¶æ‡¶∞ ‡¶™‡ßç‡¶∞‡ßü‡ßã‡¶ú‡¶®!");
        if(amt < minLimit) return alert("‡¶Æ‡¶ø‡¶®‡¶ø‡¶Æ‡¶æ‡¶Æ ‡¶≤‡¶ø‡¶Æ‡¶ø‡¶ü $" + minLimit.toFixed(2)); 
        if(amt > userData.balance) return alert("‡¶™‡¶∞‡ßç‡¶Ø‡¶æ‡¶™‡ßç‡¶§ ‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏ ‡¶®‡ßá‡¶á!"); 
        
        db.ref('withdraws').push({ uid: userData.uid, email: userData.email, amount: amt, method: method, number: num, status: "Pending", date: new Date().toLocaleString() }).then(() => { 
            db.ref('users/' + userData.uid).update({ balance: (parseFloat(userData.balance) - amt) }); 
            alert("‡¶∏‡¶´‡¶≤ ‡¶π‡ßü‡ßá‡¶õ‡ßá!"); 
        }); 
    }

    function fetchLeaderboard() {
        db.ref('users').orderByChild('balance').limitToLast(10).on('value', snap => {
            const list = document.getElementById('leaderboardList');
            let html = ""; let users = [];
            snap.forEach(child => { users.push(child.val()); });
            users.reverse().forEach((u, index) => {
                html += `<div class="rank-card ${index === 0 ? "rank-1" : ""}"><div style="display:flex;align-items:center;"><div class="rank-number">${index+1}</div><div><div style="font-weight:bold;font-size:14px;">${u.email.split('@')[0]}</div></div></div><div style="font-weight:bold;color:var(--primary-blue)">$${(u.balance||0).toFixed(3)}</div></div>`;
            });
            list.innerHTML = html;
        });
    }

    function fetchWithdrawHistory() { db.ref('withdraws').orderByChild('email').equalTo(userData.email).on('value', snap => { const list = document.getElementById('withdrawHistoryList'); let html = ""; if(!snap.exists()) { list.innerHTML = "No History"; return; } snap.forEach(child => { const w = child.val(); let color = w.status === 'Paid' ? '#2ecc71' : (w.status === 'Rejected' ? '#e74c3c' : '#f1c40f'); html += `<div class="hist-item"><div><b>${w.method}</b><br><small>${w.date}</small></div><div style="color:${color}">$${w.amount.toFixed(3)} - ${w.status}</div></div>`; }); list.innerHTML = html; }); }
    function renderDailyActivity() { 
        const list = document.getElementById('dailyActivityList');
        if (!userData.dailyActivity) { list.innerHTML = "<p style='text-align:center;color:gray;'>No Activity</p>"; return; }
        const sortedDates = Object.keys(userData.dailyActivity).reverse();
        list.innerHTML = sortedDates.slice(0, 5).map(date => {
            const data = userData.dailyActivity[date];
            return `<div class="hist-item"><div><b>${date}</b><br><small>Ads: ${data.ads || 0}</small></div><div style="color:var(--success-green); font-weight:bold;">+$${(data.income || 0).toFixed(3)}</div></div>`;
        }).join('');
    }

    function checkCooldowns() { const now = Date.now(), adBtn = document.getElementById('adBtn'), timerText = document.getElementById('main-timer'); if (userData.taskLockTime && now < userData.taskLockTime) { if(adBtn) adBtn.disabled = true; startTaskCountdown(userData.taskLockTime); } else { if(userData.taskLockTime) db.ref('users/' + userData.uid).update({ ads: 0, spins: 0, taskLockTime: 0 }); if(adBtn) adBtn.disabled = false; if(timerText) timerText.innerText = "00:00:00"; } }
    function startTaskCountdown(lock) { if(window.taskInterval) clearInterval(window.taskInterval); window.taskInterval = setInterval(() => { const diff = lock - Date.now(); if (diff <= 0) { clearInterval(window.taskInterval); updateUI(); return; } const h = Math.floor(diff/3600000), m = Math.floor((diff%3600000)/60000), s = Math.floor((diff%60000)/1000); document.getElementById('main-timer').innerText = `${h<10?'0'+h:h}:${m<10?'0'+m:m}:${s<10?'0'+s:s}`; }, 1000); }
    function claimDailyBonus() { if (typeof show_10411839 === 'function') { show_10411839().then(() => { db.ref('users/' + userData.uid).update({ balance: (parseFloat(userData.balance) + parseFloat(appConfig.dailyBonus)), lastDaily: Date.now(), lastActive: Date.now() }); }); } }

    function copyRef() { 
        const shareLink = `https://t.me/lite_income_bot?start=${userData.uid}`; 
        navigator.clipboard.writeText(shareLink); 
        alert("‡¶ï‡¶™‡¶ø ‡¶π‡ßü‡ßá‡¶õ‡ßá!"); 
    }
    
    function shareOnTelegram() {
        const shareLink = `https://t.me/lite_income_bot?start=${userData.uid}`;
        const shareText = encodeURIComponent("üî• ‡¶™‡ßç‡¶∞‡¶§‡¶ø‡¶¶‡¶ø‡¶® ‡¶≠‡¶ø‡¶°‡¶ø‡¶ì ‡¶¶‡ßá‡¶ñ‡ßá ‡¶è‡¶¨‡¶Ç ‡¶Ü‡ßü ‡¶ï‡¶∞‡ßÅ‡¶®!\n‡¶≤‡¶ø‡¶Ç‡¶ï: ");
        window.open(`https://t.me/share/url?url=${encodeURIComponent(shareLink)}&text=${shareText}`, '_blank');
    }

    function logout() { localStorage.clear(); location.reload(); }
    function togglePassword() { const pass = document.getElementById('auth-pass'); pass.type = pass.type === "password" ? "text" : "password"; }
    function toggleAuth() { const title = document.getElementById('auth-title'), btn = document.getElementById('auth-btn'), text = document.getElementById('auth-toggle-text'); if (title.innerText === "Login") { title.innerText = "Sign Up"; btn.innerText = "Register Now"; text.innerHTML = 'Account ‡¶Ü‡¶õ‡ßá? <span style="color: var(--primary-blue); cursor: pointer;" onclick="toggleAuth()">Login ‡¶ï‡¶∞‡ßÅ‡¶®</span>'; } else { title.innerText = "Login"; btn.innerText = "Login Now"; text.innerHTML = 'Account ‡¶®‡ßá‡¶á? <span style="color: var(--primary-blue); cursor: pointer;" onclick="toggleAuth()">Sign Up ‡¶ï‡¶∞‡ßÅ‡¶®</span>'; } }
    function showPage(id, el) { 
        document.querySelectorAll('.page').forEach(p => p.classList.remove('active-page')); 
        document.getElementById(id).classList.add('active-page'); 
        if(el && el.classList.contains('nav-item')) { document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active')); el.classList.add('active'); } 
        if(id === 'rank') fetchLeaderboard();
        if(id === 'refer_claim') fetchReferralList();
    }
</script>
</body>
                    </html>
