<!DOCTYPE html>
<html lang="bn">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Lite Income - Pro</title>

<script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-database-compat.js"></script>

<style>
:root {
    --primary-gold: #ffcc33; /* Brighter Gold */
    --bg-dark: #050505;
    --card-bg: #121212;
    --text-light: #e0e0e0;
    --nav-bg: #0f0f0f;
    --accent: #d4af37;
}
body { margin:0; font-family: 'Segoe UI', Roboto, sans-serif; background: var(--bg-dark); color: var(--text-light); overflow-x: hidden;}
.container { padding: 20px; padding-bottom: 90px; max-width: 500px; margin: auto; }
.card { background: var(--card-bg); padding:20px; margin:15px 0; border-radius:15px; border: 1px solid #222; box-shadow: 0 10px 20px rgba(0,0,0,0.5); }
.card h2 { color: var(--primary-gold); margin:0 0 15px 0; font-size: 20px; border-left: 4px solid var(--primary-gold); padding-left: 10px; }
.btn { display:block; background: linear-gradient(145deg, #ffcc33, #d4af37); color:#000; text-align:center; padding:14px; border-radius:12px; margin:12px 0; cursor:pointer; font-weight:bold; transition: 0.3s; border:none; width:100%; font-size:16px; text-transform: uppercase; letter-spacing: 1px; }
.btn:active { transform: scale(0.95); }
input, select { width:100%; padding:12px; margin:8px 0; border-radius:8px; border:1px solid #333; outline:none; background: #1a1a1a; color: #fff; }

/* Bottom Nav Styling */
.bottom-nav { display:flex; justify-content:space-around; background:var(--nav-bg); padding:12px 0; position:fixed; bottom:0; width:100%; border-top:1px solid var(--primary-gold); z-index: 1000; box-shadow: 0 -5px 15px rgba(0,0,0,0.8); }
.nav-btn { flex:1; text-align:center; color:#888; font-weight:bold; cursor:pointer; font-size: 13px; transition: 0.3s; }
.nav-btn.active { color: var(--primary-gold); }

.hidden { display:none; }
h1.app-title { text-align:center; color: var(--primary-gold); margin-bottom:25px; font-size:32px; font-weight:900; letter-spacing: 2px; text-shadow: 0 0 10px rgba(212,175,55,0.3); }

/* Home Grid */
.home-grid { display:grid; grid-template-columns: 1fr 1fr; gap:12px; }
.home-card { background: #181818; border: 1px solid #282828; border-radius:15px; padding:15px; text-align:center; }
.home-card h3 { color: #888; margin:0; font-size:12px; text-transform: uppercase; }
.home-card p { margin:5px 0 0 0; font-size:18px; font-weight:bold; color: var(--primary-gold); }

.status-badge { display:inline-block; padding:3px 8px; border-radius:5px; font-size:10px; background: #333; color: #fff; margin-bottom: 5px; }
.task-balance { text-align:center; padding:25px; background: linear-gradient(145deg, #1a1a1a, #0a0a0a); border-radius:15px; border: 1px solid var(--primary-gold); margin-bottom: 20px; }
.task-balance h3 { margin:0; color: #888; font-size: 14px; }
.task-balance p { margin: 10px 0 0 0; font-size: 32px; font-weight: 900; color: var(--primary-gold); }
</style>

<script src="https://telegram.org/js/telegram-web-app.js"></script>
<script src='//libtl.com/sdk.js' data-zone='10411839' data-sdk='show_10411839'></script>

</head>
<body>

<div id="loginPage" class="container">
  <h1 class="app-title">LITE INCOME</h1>
  <div class="card">
    <h2>‡¶∂‡ßÅ‡¶∞‡ßÅ ‡¶ï‡¶∞‡ßÅ‡¶®</h2>
    <p style="font-size: 12px; color: #888;">‡¶®‡¶æ‡¶Æ ‡¶è‡¶¨‡¶Ç ‡¶´‡ßã‡¶® ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞ ‡¶¶‡¶ø‡ßü‡ßá ‡¶è‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü ‡¶ñ‡ßÅ‡¶≤‡ßÅ‡¶®</p>
    <input type="text" id="regName" placeholder="‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶™‡ßÅ‡¶∞‡ßã ‡¶®‡¶æ‡¶Æ">
    <input type="number" id="regPhone" placeholder="‡¶¨‡¶ø‡¶ï‡¶æ‡¶∂/‡¶®‡¶ó‡¶¶ ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞">
    <button class="btn" onclick="handleAuth()">‡¶≤‡¶ó‡¶á‡¶® / ‡¶∏‡¶æ‡¶á‡¶® ‡¶Ü‡¶™</button>
  </div>
</div>

<div id="app" class="container hidden">
  <div id="homePage" class="page">
    <div id="notice" class="card" style="border-left: 5px solid var(--primary-gold);">
      <h2 id="noticeTitle" style="font-size: 16px; border:none; padding:0;"></h2>
      <p id="noticeText" style="font-size: 14px; margin:0; color: #bbb;"></p>
    </div>

    <div class="home-grid">
      <div class="home-card"><h3>‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶Ü‡¶á‡¶°‡¶ø</h3><p id="userIdDisplay">--</p></div>
      <div class="home-card"><h3>‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏</h3><p>$<span id="mainBalance">0.00</span></p></div>
      <div class="home-card"><h3>‡¶Æ‡ßã‡¶ü ‡¶∞‡ßá‡¶´‡¶æ‡¶∞</h3><p id="totalRef">0</p></div>
      <div class="home-card"><h3>‡¶Ü‡¶ú‡¶ï‡ßá‡¶∞ ‡¶è‡¶°</h3><p id="adsAvailable">0/15</p></div>
    </div>
    <button class="btn" style="margin-top: 20px;" onclick="showPage('taskPage')">‡¶ï‡¶æ‡¶ú ‡¶∂‡ßÅ‡¶∞‡ßÅ ‡¶ï‡¶∞‡ßÅ‡¶®</button>
  </div>

  <div id="taskPage" class="page hidden">
    <div class="task-balance">
        <h3>Current Earnings</h3>
        <p>$<span id="mainBalanceTask">0.00</span></p>
    </div>
    <div class="card">
        <h2>Daily Tasks</h2>
        <p style="text-align:center; color: #888;">‡¶¨‡¶æ‡¶ï‡¶ø ‡¶è‡¶°: <span id="adsRemaining">0</span> / 15</p>
        <button id="adBtn" class="btn" onclick="runAdTask()">‡¶è‡¶° ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶®</button>
    </div>
  </div>

  <div id="withdrawPage" class="page hidden">
    <div class="card">
        <h2>Withdraw Funds</h2>
        <p style="font-size:13px; color:#888;">‡¶Æ‡¶ø‡¶®‡¶ø‡¶Æ‡¶æ‡¶Æ ‡¶â‡¶á‡¶•‡¶°‡ßç‡¶∞: $<span id="minWithdrawDisp"></span> | ‡¶™‡ßç‡¶∞‡ßü‡ßã‡¶ú‡¶®‡ßÄ‡ßü ‡¶∞‡ßá‡¶´‡¶æ‡¶∞: <span id="reqRefDisp"></span></p>
        <select id="paymentMethod">
          <option value="bKash">bKash</option>
          <option value="Nagad">Nagad</option>
          <option value="Rocket">Rocket</option>
        </select>
        <input type="text" id="accNumber" placeholder="‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞">
        <input type="number" id="wdAmount" placeholder="‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£ ($)">
        <button class="btn" onclick="submitWithdraw()">‡¶∞‡¶ø‡¶ï‡ßã‡ßü‡ßá‡¶∏‡ßç‡¶ü ‡¶™‡¶æ‡¶†‡¶æ‡¶®</button>
    </div>
  </div>

  <div id="profilePage" class="page hidden">
    <div class="card" style="text-align:center;">
        <div style="width:70px; height:70px; background:var(--primary-gold); border-radius:50%; margin:auto; display:flex; align-items:center; justify-content:center; color:#000; font-size:24px; font-weight:bold;" id="avatar">U</div>
        <h2 id="profileName" style="border:none; padding:0; margin-top:10px;">User Name</h2>
        <p id="profilePhone" style="color:#888; font-size:13px;"></p>
    </div>
    <div class="card">
        <h2>‡¶∞‡ßá‡¶´‡¶æ‡¶∞‡ßá‡¶≤ ‡¶≤‡¶ø‡¶Ç‡¶ï</h2>
        <p id="refLink" style="font-size:11px; background:#000; padding:10px; border-radius:5px; word-break:break-all; color: var(--primary-gold);"></p>
        <button class="btn" style="font-size:12px; padding:8px;" onclick="copyRef()">‡¶≤‡¶ø‡¶Ç‡¶ï ‡¶ï‡¶™‡¶ø ‡¶ï‡¶∞‡ßÅ‡¶®</button>
    </div>
    <div style="display:grid; grid-template-columns:1fr 1fr; gap:10px;">
        <button class="btn" style="background:#222; color:#fff;" onclick="window.open(CONFIG.TELEGRAM_LINK)">Channel</button>
        <button class="btn" style="background:#222; color:#fff;" onclick="window.open(CONFIG.SUPPORT_LINK)">Support</button>
    </div>
    <p onclick="adminAccess()" style="text-align:center; color:#222; font-size:10px; cursor:pointer; margin-top:20px;">SYSTEM ADMIN</p>
  </div>

  <div id="adminPage" class="page hidden">
    <h2 style="color:red; border-left-color:red;">ADMIN DASHBOARD</h2>
    <div class="card">
        <h3>‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶ï‡¶®‡ßç‡¶ü‡ßç‡¶∞‡ßã‡¶≤</h3>
        <input type="text" id="admUserId" placeholder="‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶Ü‡¶á‡¶°‡¶ø">
        <input type="number" id="admAmount" placeholder="‡¶Ö‡ßç‡¶Ø‡¶æ‡¶Æ‡¶æ‡¶â‡¶®‡ßç‡¶ü ($)">
        <div style="display:flex; gap:5px;">
            <button class="btn" style="background:green; color:#fff;" onclick="updateBalanceAdmin('ADD')">Add</button>
            <button class="btn" style="background:red; color:#fff;" onclick="updateBalanceAdmin('SUB')">Less</button>
        </div>
        <button class="btn" style="background:#444; color:#fff;" onclick="manageBan('BAN')">User Ban</button>
    </div>

    <div class="card">
        <h3>Pending Referrals</h3>
        <div id="pendingRefList" style="font-size:12px; max-height: 200px; overflow-y: auto;">
            </div>
    </div>

    <div class="card">
        <h3>Withdraw Requests</h3>
        <div id="pendingWdList" style="font-size:12px;">
            </div>
    </div>

    <button class="btn" style="background:#222; color:#fff;" onclick="showPage('homePage')">Exit Admin</button>
  </div>

  <div class="bottom-nav">
    <div class="nav-btn active" onclick="showPage('homePage', this)">Home</div>
    <div class="nav-btn" onclick="showPage('taskPage', this)">Task</div>
    <div class="nav-btn" onclick="showPage('withdrawPage', this)">Withdraw</div>
    <div class="nav-btn" onclick="showPage('profilePage', this)">Profile</div>
  </div>
</div>

<script>
// --- CONFIGURATION ---
const firebaseConfig = {
  apiKey: "AIzaSyD_umGq2C78hRinwHGl9SNVFuZzb12iooc",
  authDomain: "lite-income-f6287.firebaseapp.com",
  projectId: "lite-income-f6287",
  storageBucket: "lite-income-f6287.firebasestorage.app",
  messagingSenderId: "721063152582",
  appId: "1:721063152582:web:e195b9e7c79ac274ba40c7",
  databaseURL: "https://lite-income-f6287-default-rtdb.firebaseio.com/"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.database();

const CONFIG = {
  DAILY_AD_LIMIT: 15,
  AD_REWARD: 0.80,
  REF_REWARD: 0.50,
  MIN_WITHDRAW: 1,
  REQ_REFERRAL: 10,
  ADMIN_PASS: "7860",
  TELEGRAM_LINK: "https://t.me/liteincomebd",
  SUPPORT_LINK: "https://t.me/liteincomebd",
  BOT_TOKEN: "8027784844:AAGHfNwr1Yz5gOpTmNJ6OXrFW2X3GiEJLmc",
  ADMIN_CHAT_ID: "6230555979"
};

let currentUser = null;
const tg = window.Telegram.WebApp;
const urlParams = new URLSearchParams(window.location.search);
const referrerId = tg.initDataUnsafe.start_param || urlParams.get('start');

// --- AUTH SYSTEM ---
function handleAuth() {
    const name = document.getElementById('regName').value;
    const phone = document.getElementById('regPhone').value;

    if(!name || !phone) return alert("‡¶∏‡¶¨ ‡¶§‡¶•‡ßç‡¶Ø ‡¶¶‡¶ø‡¶®");

    const uid = phone; // Using phone as UID for simplicity
    db.ref('users/' + uid).once('value', snapshot => {
        if(snapshot.exists()) {
            loadUserData(snapshot.val());
        } else {
            // New Registration
            const newUser = {
                id: uid,
                name: name,
                phone: phone,
                balance: 0,
                referrals: 0,
                adsToday: 0,
                isBanned: false,
                lastAdDate: new Date().toDateString()
            };
            db.ref('users/' + uid).set(newUser);
            
            // Handle Referral Tracking (Admin Pending)
            if(referrerId && referrerId !== uid) {
                db.ref('pending_referrals').push({
                    from: referrerId,
                    to: uid,
                    toName: name,
                    status: 'pending',
                    timestamp: Date.now()
                });
                sendTG(`ü§ù New Referral! \nUser ${name} joined under ID ${referrerId}. Check admin panel to approve.`);
            }
            loadUserData(newUser);
        }
    });
}

function loadUserData(data) {
    if(data.isBanned) {
        alert("You are BANNED!");
        return;
    }
    currentUser = data;
    // Check Daily Reset
    if(currentUser.lastAdDate !== new Date().toDateString()) {
        currentUser.adsToday = 0;
        currentUser.lastAdDate = new Date().toDateString();
        db.ref('users/' + currentUser.id).update({ adsToday: 0, lastAdDate: currentUser.lastAdDate });
    }
    
    document.getElementById('loginPage').classList.add('hidden');
    document.getElementById('app').classList.remove('hidden');
    setupUI();
}

function setupUI() {
    document.getElementById('noticeTitle').innerText = "üì¢ Welcome " + currentUser.name;
    document.getElementById('noticeText').innerText = "‡¶ï‡¶æ‡¶ú ‡¶∂‡ßá‡¶∑ ‡¶ï‡¶∞‡ßá ‡¶â‡¶á‡¶•‡¶°‡ßç‡¶∞ ‡¶¶‡¶ø‡¶®‡•§ ‡¶´‡ßá‡¶ï ‡¶∞‡ßá‡¶´‡¶æ‡¶∞ ‡¶ï‡¶∞‡¶¨‡ßá‡¶® ‡¶®‡¶æ‡•§";
    document.getElementById('profileName').innerText = currentUser.name;
    document.getElementById('profilePhone').innerText = currentUser.phone;
    document.getElementById('avatar').innerText = currentUser.name[0];
    document.getElementById('userIdDisplay').innerText = currentUser.id;
    document.getElementById('minWithdrawDisp').innerText = CONFIG.MIN_WITHDRAW;
    document.getElementById('reqRefDisp').innerText = CONFIG.REQ_REFERRAL;
    document.getElementById('refLink').innerText = "https://t.me/LiteIncomeBot?start=" + currentUser.id;
    updateBalances();
}

function updateBalances() {
    document.getElementById('mainBalance').innerText = currentUser.balance.toFixed(2);
    document.getElementById('mainBalanceTask').innerText = currentUser.balance.toFixed(2);
    document.getElementById('mainBalanceProfile').innerText = currentUser.balance.toFixed(2);
    document.getElementById('totalRef').innerText = currentUser.referrals;
    document.getElementById('profileRef').innerText = currentUser.referrals;
    document.getElementById('adsAvailable').innerText = currentUser.adsToday + "/15";
    document.getElementById('adsRemaining').innerText = 15 - currentUser.adsToday;
}

// --- TASK SYSTEM ---
function runAdTask() {
    if(currentUser.adsToday >= 15) return alert("‡¶Ü‡¶ú‡¶ï‡ßá‡¶∞ ‡¶≤‡¶ø‡¶Æ‡¶ø‡¶ü ‡¶∂‡ßá‡¶∑!");
    
    if(typeof show_10411839 === 'function'){
        show_10411839().then(() => {
            currentUser.balance += CONFIG.AD_REWARD;
            currentUser.adsToday += 1;
            db.ref('users/' + currentUser.id).update({
                balance: currentUser.balance,
                adsToday: currentUser.adsToday
            });
            updateBalances();
            sendTG(`üì∫ Ad Viewed: ${currentUser.name} ($${CONFIG.AD_REWARD})`);
        }).catch(() => alert("‡¶è‡¶° ‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá ‡¶®‡¶æ, ‡¶è‡¶ï‡¶ü‡ßÅ ‡¶™‡¶∞ ‡¶ö‡ßá‡¶∑‡ßç‡¶ü‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§"));
    }
}

// --- WITHDRAW SYSTEM ---
function submitWithdraw() {
    const amount = parseFloat(document.getElementById('wdAmount').value);
    const acc = document.getElementById('accNumber').value;
    const method = document.getElementById('paymentMethod').value;

    if(amount < CONFIG.MIN_WITHDRAW) return alert("‡¶Æ‡¶ø‡¶®‡¶ø‡¶Æ‡¶æ‡¶Æ $"+CONFIG.MIN_WITHDRAW);
    if(currentUser.balance < amount) return alert("‡¶™‡¶∞‡ßç‡¶Ø‡¶æ‡¶™‡ßç‡¶§ ‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏ ‡¶®‡ßá‡¶á");
    if(currentUser.referrals < CONFIG.REQ_REFERRAL) return alert(CONFIG.REQ_REFERRAL + "‡¶ü‡¶ø ‡¶∞‡ßá‡¶´‡¶æ‡¶∞ ‡¶™‡ßç‡¶∞‡ßü‡ßã‡¶ú‡¶®");

    const wdData = {
        uid: currentUser.id,
        name: currentUser.name,
        amount: amount,
        method: method,
        account: acc,
        timestamp: Date.now()
    };

    db.ref('withdrawals').push(wdData);
    currentUser.balance -= amount;
    db.ref('users/' + currentUser.id).update({ balance: currentUser.balance });
    updateBalances();
    alert("‡¶â‡¶á‡¶•‡¶°‡ßç‡¶∞ ‡¶∞‡¶ø‡¶ï‡ßã‡ßü‡ßá‡¶∏‡ßç‡¶ü ‡¶™‡¶æ‡¶†‡¶æ‡¶®‡ßã ‡¶π‡ßü‡ßá‡¶õ‡ßá!");
    sendTG(`üí∞ Withdrawal Request!\nUser: ${currentUser.name}\nAmount: $${amount}\nMethod: ${method}\nNo: ${acc}`);
}

// --- ADMIN SYSTEM ---
function adminAccess() {
    const p = prompt("‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶® ‡¶™‡¶æ‡¶∏‡¶ì‡ßü‡¶æ‡¶∞‡ßç‡¶°:");
    if(p === CONFIG.ADMIN_PASS) {
        showPage('adminPage');
        loadAdminData();
    }
}

function loadAdminData() {
    // Load Pending Referrals
    db.ref('pending_referrals').on('value', snap => {
        const list = document.getElementById('pendingRefList');
        list.innerHTML = "";
        snap.forEach(child => {
            const data = child.val();
            list.innerHTML += `<div class="card" style="font-size:11px; margin:5px 0;">
                By: ${data.from} | New: ${data.toName}
                <button onclick="approveRef('${child.key}', '${data.from}')" style="background:green; color:#fff; border:none; padding:5px; margin-left:10px;">Approve</button>
            </div>`;
        });
    });

    // Load Withdrawals
    db.ref('withdrawals').on('value', snap => {
        const list = document.getElementById('pendingWdList');
        list.innerHTML = "";
        snap.forEach(child => {
            const data = child.val();
            list.innerHTML += `<div class="card" style="font-size:11px; margin:5px 0;">
                ${data.name} | $${data.amount} | ${data.method} | ${data.account}
                <button onclick="deleteWd('${child.key}')" style="background:red; color:#fff; border:none; padding:5px;">Clear</button>
            </div>`;
        });
    });
}

function approveRef(key, referrerId) {
    db.ref('users/' + referrerId).once('value', snap => {
        if(snap.exists()) {
            let refData = snap.val();
            db.ref('users/' + referrerId).update({
                balance: (refData.balance || 0) + CONFIG.REF_REWARD,
                referrals: (refData.referrals || 0) + 1
            });
            db.ref('pending_referrals/' + key).remove();
            alert("Referral Approved!");
        }
    });
}

function updateBalanceAdmin(type) {
    const targetId = document.getElementById('admUserId').value;
    const amount = parseFloat(document.getElementById('admAmount').value);
    db.ref('users/' + targetId).once('value', snap => {
        if(snap.exists()){
            let u = snap.val();
            let newBal = type === 'ADD' ? u.balance + amount : u.balance - amount;
            db.ref('users/' + targetId).update({ balance: newBal });
            alert("Updated!");
        } else { alert("User not found!"); }
    });
}

function deleteWd(key) { if(confirm("Clear this request?")) db.ref('withdrawals/' + key).remove(); }

// --- HELPERS ---
function showPage(pageId, btn) {
    document.querySelectorAll('.page').forEach(p => p.classList.add('hidden'));
    document.getElementById(pageId).classList.remove('hidden');
    if(btn) {
        document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
    }
}

function copyRef() {
    navigator.clipboard.writeText(document.getElementById('refLink').innerText);
    alert("‡¶≤‡¶ø‡¶Ç‡¶ï ‡¶ï‡¶™‡¶ø ‡¶π‡ßü‡ßá‡¶õ‡ßá!");
}

function sendTG(msg) {
    fetch(`https://api.telegram.org/bot${CONFIG.BOT_TOKEN}/sendMessage?chat_id=${CONFIG.ADMIN_CHAT_ID}&text=${encodeURIComponent(msg)}&parse_mode=HTML`);
}
</script>
</body>
</html>
